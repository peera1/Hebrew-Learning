// Hebrew voice selection
let hebrewVoice = null;
function loadVoices() {
  const voices = window.speechSynthesis.getVoices();
  hebrewVoice = voices.find(v => v.lang === 'he-IL');
}
window.speechSynthesis.onvoiceschanged = loadVoices;
loadVoices();

function speakLetterAndWords(idx) {
  if (idx < 0 || idx >= letters.length) return;
  const l = letters[idx];
  const words = l.examples.join(', ');
  const text = `转 : ${l.name}.  砖转转 转 ${l.name} : ${words}.`;
  speak(text);
}

function speak(text) {
  if ('speechSynthesis' in window) {
    window.speechSynthesis.cancel();
    const utter = new window.SpeechSynthesisUtterance(text);
    utter.lang = 'he-IL';
    if (hebrewVoice) utter.voice = hebrewVoice;
    utter.rate = 0.7;
    window.speechSynthesis.speak(utter);
  } else {
    alert('驻驻 砖  转 砖注转 拽');
  }
}
function render() {
  if (currentIndex >= letters.length) {
    document.getElementById('game').innerHTML = `
      <div class="reward"></div>
      <h1 class="name" style="font-size:2.7rem;"> !</h1>
      <div style="font-size:1.7rem; color:#444; margin-bottom:20px;">转 转  转转!</div>
      <div class="stars">猸锔 猸锔 猸锔</div>
      <button class="play-again-btn" onclick="restartGame()">砖拽 砖</button>
    `;
    return;
  }
  const l = letters[currentIndex];
  document.getElementById('game').innerHTML = `
    <div class="letter">${l.letter}</div>
    <div class="emoji">${l.emoji}</div>
    <div class="name">${l.name}</div>
    <button class="sound-btn" onclick="speakLetterAndWords(${currentIndex})"> 砖注 爪</button>
    <div class="examples">
      ${l.examples.map(word => `<span onclick="speak('${word}')">${word}</span>`).join('')}
    </div>
    <div>
      <button class="nav-btn" onclick="prevLetter()" ${currentIndex === 0 ? 'disabled' : ''}>拽</button>
      <button class="nav-btn" onclick="nextLetter()">${currentIndex === letters.length-1 ? '住' : ''}</button>
    </div>
  `;
}
function nextLetter() { if(currentIndex<letters.length){currentIndex++;render();} }
function prevLetter() { if(currentIndex>0){currentIndex--;render();} }
function restartGame() { currentIndex = 0; render(); }
window.speak = speak;
window.speakLetterAndWords = speakLetterAndWords;
window.nextLetter = nextLetter;
window.prevLetter = prevLetter;
window.restartGame = restartGame;
render();
